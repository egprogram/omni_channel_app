<div class="top-page">
    <!-- top_bar -->
    <nav class="navbar fixed-top" style="height: 56px; background: transparent;">
    <div class="container d-flex justify-content-between align-items-center">
        <!-- å·¦å´ï¼šãƒ­ã‚´ï¼‹ã‚¿ã‚¤ãƒˆãƒ« -->
        <div class="d-flex align-items-center gap-2">
        <h5 class="mb-0 beta-ban">Î²ç‰ˆ</h5>
        </div>
    </nav>

    <!-- ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ -->
    <div class="top-icons">
        <div class="icon" data-index="0">SIR-Q</div>
        <div class="icon" data-index="1">ç”Ÿæ´»</div>
        <div class="icon" data-index="2">ã‚¢ãƒ—ãƒª</div>
        <div class="icon" data-index="3">æ—¥å¸¸</div>
    </div>

    <!-- ãƒ¡ã‚¤ãƒ³ã‚«ãƒ«ãƒ¼ã‚»ãƒ« -->
    <div class="swiper">
        <div class="swiper-wrapper">

            <!-- AI -->
            <div class="swiper-slide">
                <div class="ai-page">
                    <%= form_with url: ai_ask_path, method: :post, html: { id: "aiForm", class: "d-flex align-items-center ai-input-wrapper " } do |f| %>

                        <!-- å…¥åŠ› -->
                        <%= f.text_field :message, 
                            class: "form-control ai-input", 
                            placeholder: "çŸ¥å¤šåŠå³¶ã«ã¤ã„ã¦è³ªå•ã—ã¦ã¿ã‚ˆã†", 
                            id: "aiInput" %>

                        <!-- é€ä¿¡ã‚¢ã‚¤ã‚³ãƒ³ -->
                        <span class="material-icons input-icon send-icon" id="sendBtn">send</span>

                    <% end %>
                </div>
                <script>
                    document.addEventListener("DOMContentLoaded", () => {
                    const sendBtn = document.getElementById("sendBtn");
                    const form = document.getElementById("aiForm");
                    const input = document.getElementById("aiInput");

                    sendBtn.addEventListener("click", (e) => {
                        // ç©ºæ¬„ãªã‚‰é€ä¿¡ã•ã›ãªã„
                        if (!input.value.trim()) {
                            e.preventDefault(); 
                            alert("ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„"); 
                            return;
                        }

                        form.submit();
                    });

                    // ç©ºæ¬„ãªã‚‰ãƒœã‚¿ãƒ³éæ´»æ€§åŒ–
                    input.addEventListener("input", () => {
                        if (input.value.trim()) {
                        sendBtn.style.opacity = "1";      
                        sendBtn.style.pointerEvents = "auto";
                        } else {
                        sendBtn.style.opacity = "0.5";   
                        sendBtn.style.pointerEvents = "none";
                        }
                    });

                    // ãƒšãƒ¼ã‚¸ãƒ­ãƒ¼ãƒ‰æ™‚ã«åˆæœŸçŠ¶æ…‹ãƒã‚§ãƒƒã‚¯
                    if (!input.value.trim()) {
                        sendBtn.style.opacity = "0.5";
                        sendBtn.style.pointerEvents = "none";
                    }
                    });
                </script>
            </div>

            <!-- ç”Ÿæ´» -->
            <div class="swiper-slide">
                <div class="life-page">
                    <p class="ai-page-today" id="aiToday">1æœˆ18æ—¥(æ—¥)</p>
                    <p class="ai-page-time" id="aiTime">21:00</p>
                    <script>
                        document.addEventListener("turbo:load", () => {
                        const timeEl = document.getElementById("aiTime");
                        const todayEl = document.getElementById("aiToday");

                        function updateDateTime() {
                            const now = new Date();

                            const hours = now.getHours().toString().padStart(2, '0');
                            const minutes = now.getMinutes().toString().padStart(2, '0');
                            timeEl.textContent = `${hours}:${minutes}`;

                            const weekDays = ["æ—¥", "æœˆ", "ç«", "æ°´", "æœ¨", "é‡‘", "åœŸ"];
                            const month = now.getMonth() + 1; // 0å§‹ã¾ã‚Šãªã®ã§ +1
                            const date = now.getDate();
                            const day = weekDays[now.getDay()];
                            todayEl.textContent = `${month}æœˆ${date}æ—¥(${day})`;
                        }

                        updateDateTime();

                        setInterval(updateDateTime, 60000);
                        });
                    </script>
                    <div class="card top-page-card p-1 d-flex align-items-start" style="max-width: 500px; margin: 20px auto;">
                        <div class="d-flex align-items-center">
                            <!-- ã‚¢ã‚¤ã‚³ãƒ³ -->
                            <div class="me-3 d-flex align-items-center justify-content-center" style="min-width: 60px; font-size: 3rem; line-height: 1;">
                            â˜€ï¸
                            </div>
                            <!-- ãƒ†ã‚­ã‚¹ãƒˆ -->
                            <div>
                                <h5 class="card-title mb-1 fw-bold top-text-b">ä»Šæ—¥ã®å¤©æ°—</h5>
                                <p class="card-text mb-1 text-black" style="font-size: 1.1rem;">æ™´ã‚Œãƒ»9â„ƒ</p>
                                <small class="text-black-70">æ¹¿åº¦: 45% | é¢¨é€Ÿ: 2m/s</small>
                            </div>
                        </div>
                    </div>
                    <%= link_to trash_calendar_path do %>
                    <div class="card top-page-card p-1 d-flex align-items-start" style="max-width: 500px; margin: 20px auto;">
                        <div class="d-flex align-items-center">
                            <!-- ã‚¢ã‚¤ã‚³ãƒ³ -->
                            <div class="me-3 d-flex align-items-center justify-content-center" style="min-width: 60px; font-size: 3rem; line-height: 1;">
                            ğŸ”¥
                            </div>
                            <!-- ãƒ†ã‚­ã‚¹ãƒˆ -->
                            <div>
                                <h5 class="card-title mb-1 fw-bold top-text-b">æ˜æ—¥ã®ã‚´ãƒŸ</h5>
                                <p class="card-text mb-1 text-black" style="font-size: 1.1rem;">å¯ç‡ƒã‚´ãƒŸ</p>
                                <small class="text-black-70">8:00ã¾ã§ã«å‡ºã—ã¦ãã ã•ã„</small>
                            </div>
                        </div>
                    </div>
                    <% end %>
                </div> 
            </div>

            <!-- ã‚¢ãƒ—ãƒª -->
            <div class="swiper-slide">
                <div class="app-page">
                    <h2 class="app-page-name">ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³</h2>
                    <div class="card app-page-card p-3" style="height:50%; max-width:500px; margin:20px auto;">
                    <div class="app-grid">
                        <div class="app-item">
                        <%= link_to recommendations_path do %> 
                            <div class="app-icon osusume_icon"></div>
                        <% end %>
                            <p class="app-label">ãŠã™ã™ã‚æ²ç¤ºæ¿</p>
                        </div>

                        <div class="app-item">
                        <%= link_to complaints_new_path do %>
                            <div class="app-icon kenzya_icon"></div>
                        <% end %>
                            <p class="app-label">çŸ¥å¤šåŠå³¶ã®è³¢è€…</p>
                        </div>
                    </div>
                    </div>
                </div>
            </div>

            <!-- æ—¥å¸¸ -->
            <div class="swiper-slide">
                <div class="everyday-page">
                    <%= link_to city_event_calendar_path do %>
                    <div class="card top-page-card p-1 d-flex align-items-start" style="max-width: 500px; margin: 20px auto;">
                        <div class="d-flex align-items-center">
                            <!-- ã‚¢ã‚¤ã‚³ãƒ³ -->
                            <div class="me-3 d-flex align-items-center justify-content-center" style="min-width: 60px; font-size: 3rem; line-height: 1;"> 
                                ğŸ—“ 
                            </div>
                            <!-- ãƒ†ã‚­ã‚¹ãƒˆ -->
                            <div>
                                <h5 class="card-title mb-1 top-text-b">ã‚¤ãƒ™ãƒ³ãƒˆã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼</h5>
                            </div>
                        </div>
                    </div>
                    <% end %>
                    <p class="near-event">è¿‘æ—¥é–‹å‚¬</p>
                    <div class="card top-page-card p-1 d-flex"style="max-width: 500px; margin: 5px auto;">
                        <!-- ãƒ†ã‚­ã‚¹ãƒˆ -->
                        <div class="text-start p-1">
                            <h5 class="card-title mb-1 top-text-b">æœ¬æ—¥ã®ã‚¤ãƒ™ãƒ³ãƒˆ</h5>
                            <p class="card-text mb-1 text-black" style="font-size: 1.1rem;">è¦³å…‰ã¾ã¡ã¥ãã‚Šã‚·ãƒ³ãƒã‚¸ã‚¦ãƒ </p>
                            <small class="text-black-70">13:00 é–‹æ¼” </small>
                        </div>
                    </div>
                    <div class="card top-page-card p-1 d-flex"style="max-width: 500px; margin: 5px auto;">
                        <!-- ãƒ†ã‚­ã‚¹ãƒˆ -->
                        <div class="text-start p-1">
                            <h5 class="card-title mb-1 top-text-b">æ˜æ—¥ã®ã‚¤ãƒ™ãƒ³ãƒˆ</h5>
                            <p class="card-text mb-1 text-black" style="font-size: 1.1rem;">ãƒ™ãƒ“ãƒ¼ã‚µãƒ­ãƒ³(ä¿å¥ç¦ç¥‰ã‚»ãƒ³ã‚¿ãƒ¼)</p>
                            <small class="text-black-70">æ±æµ·å¸‚ã§é–‹å‚¬</small>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <!-- bottom_bar -->
    <footer class="footer-box">
        <!-- ãƒ›ãƒ¼ãƒ  -->
        <div style="
            border-radius: 25px;
            background: rgba(128, 128, 128, 0.3);    
            backdrop-filter: blur(6px);
            height: 55px;
            width: 60px;   
            -webkit-backdrop-filter: blur(6px); 
            display: inline-block;"
            class="d-flex justify-content-center">
            <div class="btn text-center text-secondary d-flex flex-column align-items-center justify-content-center p-0">
                <span class="material-icons " style="font-size: 28px; color: red">home</span>
                <div style="font-size: 12px; color: red;; font-weight: bold;">ãƒ›ãƒ¼ãƒ </div>
            </div>
        </div>
        <!-- ãƒãƒƒãƒ— -->
        <div style="width: 60px;" class="d-flex justify-content-center">
            <a href="<%= maps_path %>" 
                class="btn text-center text-secondary d-flex flex-column align-items-center justify-content-center p-0"
                style="height: 56px; background-color: transparent;">
                <span class="material-icons stroke-black" style="font-size: 28px;">place</span>
                <div style="font-size: 12px; color: Black; font-weight: bold;">ãƒãƒƒãƒ—</div>
            </a>
        </div>
        <!-- ãŠä¼šè¨ˆ -->
        <a href="<%= cash_path %>" 
        class="btn text-white d-flex flex-column align-items-center justify-content-center p-0"
        style="background-color: red; width: 70px; height: 60px; 
                border-radius: 20px;
                box-shadow: 0 8px 16px rgba(0,0,0,0.3);
                margin-top: -20px;
                z-index: 10;       
                position: relative;">
            <span class="material-icons" style="font-size: 28px; color: white;">qr_code_scanner</span>
            <div style="font-size: 12px; color: white;">ãŠä¼šè¨ˆ</div>
        </a>
        <!-- ã‚¯ãƒ¼ãƒãƒ³ -->
        <div style="width: 60px;" class="d-flex justify-content-center">
            <a href="<%= coupons_path %>" 
                class="btn text-center text-secondary d-flex flex-column align-items-center justify-content-center p-0"
                style="height: 56px; background-color: transparent;">
                <span class="material-icons stroke-black" style="font-size: 28px;">sell</span>
                <div style="font-size: 12px; color: Black; font-weight: bold;">ã‚¯ãƒ¼ãƒãƒ³</div>
            </a>
        </div>
        <!-- è¨­å®š -->
        <div style="width: 63px;" class="d-flex justify-content-center">
            <a href="<%= settings_path %>" 
                class="btn text-center text-secondary d-flex flex-column align-items-center justify-content-center p-0"
                style="height: 56px; background-color: transparent;">
                <span class="material-icons stroke-black" style="font-size: 28px;">account_circle</span>
                <div style="font-size: 12px; color: Black; font-weight: bold;">ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ</div>
            </a>
        </div>
    </footer> 
</div>


<script>
  // Swiper ãŒãƒ­ãƒ¼ãƒ‰æ¸ˆã¿ã‹ãƒã‚§ãƒƒã‚¯
  if (typeof Swiper === "undefined") {
    const script = document.createElement("script");
      script.src = "https://cdn.jsdelivr.net/npm/swiper@10/swiper-bundle.min.js";
      script.onload = () => {
        console.log("Swiper èª­ã¿è¾¼ã¿å®Œäº†");
        initSwiper(); // èª­ã¿è¾¼ã¿å®Œäº†ã—ãŸã‚‰å†åº¦åˆæœŸåŒ–
      };
      document.head.appendChild(script);
  }

  // Turboå¯¾å¿œã®åˆæœŸåŒ–ã‚¬ãƒ¼ãƒ‰
  if (!window.topPageSwiperInitialized) {
    window.topPageSwiperInitialized = true;

    // ä¸Šéƒ¨ã‚¢ã‚¤ã‚³ãƒ³
    const icons = document.querySelectorAll('.top-icons .icon');

    // Swiper åˆæœŸåŒ–
    const swiper = new Swiper('.swiper', {
      loop: true,           
      slidesPerView: 1,      
      spaceBetween: 0,       
      pagination: {
        clickable: true,
        renderBullet: function (index, className) {
          const labels = ['AI','ç”Ÿæ´»ãƒŠãƒ“','ã‚¢ãƒ—ãƒª','æ—¥å¸¸æƒ…å ±'];
          return '<span class="' + className + '">' + labels[index] + '</span>';
        },
      },
      simulateTouch: true,   
      touchRatio: 1,         
    });

    // ã‚¢ã‚¤ã‚³ãƒ³ã® active æ›´æ–°
    function updateActiveIcon(index) {
      icons.forEach(i => i.classList.remove('active'));
      icons[index].classList.add('active');
    }

    // åˆæœŸçŠ¶æ…‹ã®ã‚¢ã‚¤ã‚³ãƒ³ã« active ã‚’ä»˜ä¸
    updateActiveIcon(swiper.realIndex);

    // ã‚¢ã‚¤ã‚³ãƒ³ã‚¯ãƒªãƒƒã‚¯æ™‚
    icons.forEach(icon => {
      icon.addEventListener('click', () => {
        const index = parseInt(icon.dataset.index);
        swiper.slideToLoop(index); 
        updateActiveIcon(index);
      });
    });

    // ã‚¹ãƒ©ã‚¤ãƒ‰å¤‰æ›´æ™‚ã«ã‚¢ã‚¤ã‚³ãƒ³ã‚’æ›´æ–°
    swiper.on('slideChange', () => {
      updateActiveIcon(swiper.realIndex); 
    });
    
    const timeEl = document.getElementById("aiTime");

    function updateTime() {
      const now = new Date();
      // æ™‚é–“ã‚’ "HH:MM" å½¢å¼ã§è¡¨ç¤º
      const hours = now.getHours().toString().padStart(2, '0');
      const minutes = now.getMinutes().toString().padStart(2, '0');
      timeEl.textContent = `${hours}:${minutes}`;
    }

    // åˆæœŸè¡¨ç¤º
    updateTime();

    // 1åˆ†ã”ã¨ã«æ›´æ–°
    setInterval(updateTime, 60000);
  }
</script>

